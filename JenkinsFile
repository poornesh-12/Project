pipeline {
    agent any

    tools {
        jdk 'JDK7'
        maven 'Maven3'
    }

    environment {
        MAVEN_OPTS = "-Xms256m -Xmx512m"
    }

    stages {
        stage('Checkout Code') {
            steps {
                checkout scm
            }
        }

        stage('Build & Test') {
            steps {
                sh "mvn clean install -Dmaven.test.failure.ignore=true"
            }
        }

        stage('Backend Package') {
            steps {
                dir("backend") {
                    sh "mvn package -DskipTests"
                }
            }
        }

        stage('Frontend Build') {
            steps {
                dir("frontend") {
                    sh "mvn package -DskipTests"
                }
            }
        }

        stage('Archive Artifacts') {
            steps {
                archiveArtifacts artifacts: "**/target/*.jar", fingerprint: true
            }
        }
    }

    post {
        always {
            junit '**/target/surefire-reports/*.xml'
        }
    }
}

